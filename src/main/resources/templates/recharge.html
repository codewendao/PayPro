<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> ÊçêËµ†‰∏≠ÂøÉ - PayPro</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/vue/3.3.4/vue.global.min.js"></script>
    <link href="https://cdn.bootcdn.net/ajax/libs/remixicon/3.5.0/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/common.css">
    <script src="/assets/js/api-config.js"></script>
    <script src="/assets/js/http-util.js"></script>
    <style>
        .page-wrap {
            padding-top: 60px;
            padding-bottom: 60px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .title {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(to right, #fff, #94a3b8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--text-muted);
            max-width: 600px;
            margin: 0 auto;
        }

        .content {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 32px;
            margin-bottom: 40px;
        }

        .card {
            padding: 32px;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title i {
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .amounts {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .amount {
            padding: 24px 16px;
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 16px;
            text-align: center;
            cursor: pointer;
            transition: all .3s ease;
            background: rgba(255,255,255,0.03);
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .amount:hover {
            border-color: var(--primary-color);
            background: rgba(99,102,241,.1);
            transform: translateY(-2px);
        }

        .amount.active {
            border-color: var(--primary-color);
            background: rgba(99,102,241,.15);
            box-shadow: 0 4px 12px rgba(99,102,241,0.2);
        }

        .custom {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            margin-bottom: 32px;
        }

        .custom input {
            flex: 1;
            padding: 14px 16px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.08);
            background: rgba(255,255,255,0.03);
            color: var(--text-color);
            font-size: 1rem;
            transition: all .3s ease;
        }

        .custom input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99,102,241,0.1);
        }

        .methods {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 20px;
            margin-bottom: 32px;
        }

        .method {
            padding: 24px;
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 16px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 8px;
            transition: all .3s ease;
            background: rgba(255,255,255,0.03);
            position: relative;
        }

        .method:hover:not(.disabled) {
            border-color: var(--primary-color);
            background: rgba(99,102,241,.1);
            transform: translateY(-2px);
        }

        .method.active {
            border-color: var(--primary-color);
            background: rgba(99,102,241,.15);
            box-shadow: 0 4px 12px rgba(99,102,241,0.2);
        }

        .method.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(255,255,255,0.02);
        }

        .method.disabled:hover {
            border-color: rgba(255,255,255,0.08);
            background: rgba(255,255,255,0.02);
            transform: none;
        }

        .method-header {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
        }

        .method-icon {
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
        }

        .method-info {
            flex: 1;
        }

        .method-name {
            font-weight: 600;
            color: var(--text-color);
            font-size: 1rem;
            margin-bottom: 4px;
        }

        .method-description {
            font-size: 0.875rem;
            color: var(--text-muted);
            line-height: 1.4;
        }

        .method-status {
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 12px;
            margin-top: 8px;
        }

        .method-status.available {
            background: rgba(34, 197, 94, 0.1);
            color: #22c55e;
        }

        .method-status.unavailable {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .method i {
            font-size: 1.5rem;
        }

        .field {
            display: grid;
            gap: 16px;
            margin-top: 32px;
        }

        .field input {
            padding: 16px 20px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.08);
            background: rgba(255,255,255,0.03);
            color: var(--text-color);
            font-size: 1rem;
            transition: all .3s ease;
        }

        .field input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99,102,241,0.1);
        }

        .summary {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 32px;
        }

        .summary-item {
            padding: 20px;
            border-radius: 16px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            transition: all .3s ease;
        }

        .summary-item:hover {
            border-color: rgba(255,255,255,0.15);
            background: rgba(255,255,255,0.05);
        }

        .summary-item .label {
            color: var(--text-muted);
            font-size: 0.95rem;
            margin-bottom: 8px;
        }

        .summary-item .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-color);
        }

        .actions {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 32px;
        }

        .msg {
            margin-top: 20px;
            text-align: center;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 500;
        }

        .msg.error {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .msg.success {
            color: #22c55e;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.2);
        }

        .empty-state {
            text-align: center;
            color: var(--text-muted);
            padding: 40px 20px;
            background: rgba(255,255,255,0.03);
            border-radius: 16px;
            border: 1px dashed rgba(255,255,255,0.1);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        @media (max-width: 900px) {
            .content {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            .amounts {
                grid-template-columns: repeat(2, 1fr);
            }

            .methods {
                grid-template-columns: 1fr;
            }

            .actions {
                flex-direction: column;
                align-items: center;
            }

            .actions .btn {
                width: 100%;
                max-width: 200px;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .page-wrap {
                padding-top: 40px;
                padding-bottom: 40px;
            }

            .title {
                font-size: 2rem;
            }

            .card {
                padding: 24px;
            }

            .amounts {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<div id="app">
    <div class="container page-wrap">
        <div class="header">
            <h1 class="title">
                <i class="ri-wallet-3-line"></i> ÊçêËµ†‰∏≠ÂøÉ
            </h1>
            <p class="subtitle">ÈÄâÊã©ÈáëÈ¢ùÂíåÊîØ‰ªòÊñπÂºèÔºåÂø´ÈÄüÂÆåÊàêÊçêËµ†</p>
        </div>

        <div class="content">
            <div class="glass card">
                <div class="section-title">
                    <i class="ri-money-dollar-circle-line"></i> ÈáëÈ¢ù
                </div>
                <div v-if="productList.length > 0" class="amounts">
                    <div class="amount"
                         v-for="product in productList"
                         :key="product.id"
                         :class="{active: selectedProductId === product.id && !customAmount}"
                         @click="selectProduct(product)"
                         :title="product.description">
                        <div style="font-size: 1.25rem; font-weight: 600; color: var(--text-color);">Ôø•{{ formatMoney(product.money) }}</div>
                        <div style="font-size: 12px; margin-top: 8px; color: var(--text-muted);">
                            {{ product.productName }}
                        </div>
                    </div>
                </div>
                <div v-else class="empty-state">
                    <i class="ri-shopping-cart-line"></i>
                    <div>ÊöÇÊó†ÂïÜÂìÅÈÖçÁΩÆ</div>
                </div>
                <div class="custom">
                    <input type="number" min="1" step="1" placeholder="Ëá™ÂÆö‰πâÈáëÈ¢ù" v-model.number="customAmount">
                    <a class="btn btn-ghost" @click="useCustom">
                        <i class="ri-check-line"></i> ‰ΩøÁî®
                    </a>
                </div>

                <div class="section-title">
                    <i class="ri-credit-card-line"></i> ÊîØ‰ªòÊñπÂºè
                </div>
                <div class="methods">
                    <div v-for="method in paymentMethods"
                         :key="method.id"
                         class="method"
                         :class="{active: selectedPayment===method.id, disabled: !method.status}"
                         @click="method.status ? selectPayment(method.id, method.useLocalQrCode) : null">
                        <div class="method-header">
                            <div class="method-icon">{{ method.icon }}</div>
                            <div class="method-info">
                                <div class="method-name">{{ method.name }}</div>
                                <div class="method-description">{{ method.description }}</div>
                            </div>
                        </div>
                        <!--                        <div class="method-status" :class="method.status ? 'available' : 'unavailable'">-->
                        <!--                            {{ method.status ? 'ÂèØÁî®' : '‰∏çÂèØÁî®' }}-->
                        <!--                        </div>-->
                    </div>
                </div>

                <div class="field">
                    <input type="text" placeholder="Â§áÊ≥®‰ø°ÊÅØ" v-model.trim="description">
                </div>
                <div class="field">
                    <input type="email" placeholder="ÈÇÆÁÆ±ÔºàÁî®‰∫éÊé•Êî∂ÈÄöÁü•Ôºâ" v-model.trim="email">
                </div>

                <div class="actions">
                    <a class="btn btn-primary" @click="submitRecharge" :class="{disabled: !canSubmit}" :style="{ opacity: canSubmit ? 1 : 0.6 }">
                        <i class="ri-arrow-right-line"></i> ÂèëËµ∑ÊîØ‰ªò
                    </a>
                    <a href="history.html" class="btn btn-ghost">
                        <i class="ri-history-line"></i> ÊçêËµ†ËÆ∞ÂΩï
                    </a>
                </div>

                <div class="msg" v-if="message">
                    <span :class="messageType">{{ message }}</span>
                </div>
            </div>

            <div class="glass card">
                <div class="section-title">
                    <i class="ri-file-list-line"></i> ËÆ¢ÂçïÊëòË¶Å
                </div>
                <div class="summary">
                    <div class="summary-item">
                        <div class="label">ÂÖÖÂÄºÈáëÈ¢ù</div>
                        <div class="value">Ôø•{{ finalAmount }}</div>
                    </div>
                    <div class="summary-item" v-if="selectedProductDescription">
                        <div class="label">‰∫ßÂìÅÊèèËø∞</div>
                        <div class="value">{{ selectedProductDescription }}</div>
                    </div>
                    <div class="summary-item">
                        <div class="label">ÊîØ‰ªòÊñπÂºè</div>
                        <div class="value">{{ payTypeName }}</div>
                    </div>
                    <div class="summary-item">
                        <div class="label">ËÆ¢ÂçïÁä∂ÊÄÅ</div>
                        <div class="value" style="color: var(--primary-color);">ÂáÜÂ§á‰∏≠</div>
                    </div>
                </div>
                <div class="msg" style="margin-top:24px; color: var(--text-muted);">
                    <i class="ri-info-line"></i> Êèê‰∫§ÂêéÂ∞ÜË∑≥ËΩ¨Âà∞ÊîØ‰ªòÈ°µÈù¢ÂÆåÊàêÊîØ‰ªò
                </div>
            </div>
        </div>

        <div class="footer"><p>&copy; 2026 PayPro System. Designed for Creators.</p></div>
    </div>
</div>

<script>
const { createApp } = Vue;

createApp({
    data(){
        return {
            selectedProductId: null,
            customAmount: null,
            selectedPayment: 'alipay',
            useLocalQrCode: false,
            description: '',
            email: '',
            loading: false,
            message: '',
            messageType: '',
            productList: [],
            paymentMethods: [
                {
                    id: 'alipay',
                    name: 'ÊîØ‰ªòÂÆùËΩ¨Ë¥¶',
                    description: 'ÂÖçÂ§áÊ≥®',
                    icon: 'üîµ',
                    status: true,
                    useLocalQrCode: false
                },
                {
                    id: 'wechat',
                    name: 'ÂæÆ‰ø°ÊîØ‰ªò',
                    description: 'ÂæÆ‰ø°PCËá™Âä®ÁõëÂê¨Êî∂Ê¨æÂèëË¥ß',
                    icon: 'üü¢',
                    status: true,
                    useLocalQrCode: true
                },
                {
                    id: 'wechat_zs',
                    name: 'ÂæÆ‰ø°ËµûËµèÁ†ÅÊîØ‰ªò',
                    description: 'ËµûËµèÁ†ÅÊîØ‰ªò',
                    icon: 'üü¢',
                    status: true,
                    useLocalQrCode: true
                },
                {
                    id: 'alipay_dmf',
                    name: 'ÊîØ‰ªòÂÆùÂΩìÈù¢‰ªò',
                    description: 'ÂÆòÊñπ‰∫ßÂìÅÔºåÊó†ÈúÄËê•‰∏öÊâßÁÖß',
                    icon: 'üîµ',
                    status: false,
                    useLocalQrCode: false
                }
            ]
        }
    },
    computed:{
        finalAmount(){
            if(this.customAmount){ return Number(this.customAmount) || 0; }
            if(this.selectedProductId){
                const p = this.productList.find(x=>x.id===this.selectedProductId);
                return p ? Number(p.money) : 0;
            }
            return 0;
        },
        canSubmit(){
            return this.finalAmount > 0 && !!this.selectedPayment && !!this.email;
        },
        payTypeName(){
            const method = this.paymentMethods.find(m => m.id === this.selectedPayment);
            return method ? method.name : 'Êú™ÈÄâÊã©';
        },
        selectedProductDescription(){
            if (this.selectedProductId) {
                const product = this.productList.find(p => p.id === this.selectedProductId);
                return product ? (product.description || product.productName) : '';
            }
            return '';
        }
    },
    methods:{
        selectProduct(product){ this.selectedProductId = product.id; this.customAmount = null; this.clearMessages(); },
        useCustom(){ /* ‰øùÊåÅcustomAmount‰∏∫ÊúÄÁªàÈáëÈ¢ùÊù•Ê∫ê */ },
        selectPayment(t,b){ this.selectedPayment = t;this.useLocalQrCode = b },
        formatMoney(m){ if(m===0 || m){ return Number(m).toFixed(2); } return '0.00'; },
        clearMessages(){ this.message=''; this.messageType=''; },
        showError(msg){ this.message = msg; this.messageType = 'error'; },
        showSuccess(msg){ this.message = msg; this.messageType = 'success'; },
        async submitRecharge(){
            if(!this.canSubmit){ this.showError('ËØ∑ÈÄâÊã©ÈáëÈ¢ùÂíåÊîØ‰ªòÊñπÂºè'); return; }
            this.loading = true; this.clearMessages();
            try{
                const body = { money: this.finalAmount, productId: this.selectedProductId, payType: this.selectedPayment, description: this.description, nickName: '', custom: Boolean(this.customAmount), email: this.email };
                let resp = await postRequest(API_CONFIG.ENDPOINTS.RECHARGE, body);
                if(resp.code==200){
                    this.showSuccess('Â∑≤Êèê‰∫§ÔºåÊ≠£Âú®Ë∑≥ËΩ¨');
                    const that = this;
                    setTimeout(()=>{
                        const url = `payment.html?orderId=${resp.data.id}&money=${resp.data.money}&payType=${resp.data.payType}&payNum=${resp.data.payNum}&customerQr=${resp.data.custom}&picName=${encodeURIComponent((resp.data.money||0).toFixed(2))}&qrCode=${resp.data.qrCode}&payQrNum=${resp.data.payQrNum}&useLocalQrCode=${that.useLocalQrCode}`;
                        window.location.href = url;
                    },800);
                } else {
                    this.showError(resp.message || 'Êèê‰∫§Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
                }
            }catch(e){
                if((e.message||'').includes('Ë∂ÖÊó∂')){ this.showError('ÁΩëÁªúË∂ÖÊó∂ÔºåËØ∑Á®çÂêéÈáçËØï'); }
                else if((e.message||'').includes('HTTP Error')){ this.showError('ÊúçÂä°Âô®ÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï'); }
                else { this.showError('Êèê‰∫§Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï'); }
            } finally { this.loading=false; }
        }
    },
    mounted(){
        if(typeof API_CONFIG==='undefined'){ this.showError('APIÈÖçÁΩÆÂä†ËΩΩÂ§±Ë¥•'); }
        (async ()=>{
            try{
                const req = { types: ['CODE'] };
                const resp = await postRequest(API_CONFIG.ENDPOINTS.PRODUCT_LIST, req);
                if(resp.code===200 && resp.data){ this.productList = resp.data; }
            }catch(e){ this.showError('Ëé∑ÂèñÂïÜÂìÅÂàóË°®Â§±Ë¥•'); }
        })();
    }
}).mount('#app');
</script>
</body>
</html>
